<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Хоррор Истории | Расширенная версия</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --dark-bg: #0a0a0a;
            --darker-bg: #050505;
            --accent-red: #8b0000;
            --accent-red-light: #b30000;
            --text-color: #e0e0e0;
            --text-muted: #888;
            --card-bg: #1a1a1a;
            --card-border: #333;
            --premium-color: #ffd700;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --level-1: #3498db;
            --level-2: #2ecc71;
            --level-3: #e74c3c;
        }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(139, 0, 0, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(139, 0, 0, 0.05) 0%, transparent 20%);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Шапка */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--accent-red);
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: var(--accent-red);
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .logo span {
            color: var(--accent-red);
        }
        
        .user-panel {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .user-stats {
            display: flex;
            gap: 15px;
        }
        
        .stat-item {
            background-color: var(--card-bg);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid var(--card-border);
        }
        
        .stat-item.level {
            background: linear-gradient(135deg, var(--level-1), var(--level-2));
            color: white;
        }
        
        .stat-item.coins {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-red), #ff6b6b);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            position: relative;
        }
        
        .user-avatar.online::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background-color: var(--success-color);
            border-radius: 50%;
            border: 2px solid var(--dark-bg);
        }
        
        /* Навигация */
        .main-nav {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-color);
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .nav-btn.active,
        .nav-btn:hover {
            background-color: var(--accent-red);
            color: white;
        }
        
        /* Основной контент */
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 30px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 250px 1fr;
            }
            .right-sidebar {
                grid-column: 1 / -1;
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            .right-sidebar {
                grid-template-columns: 1fr;
            }
        }
        
        /* Левая панель - быстрый доступ */
        .left-sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .sidebar-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid var(--card-border);
        }
        
        .sidebar-card h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-red);
        }
        
        /* Ежедневные задания */
        .daily-quests .quest {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--card-border);
        }
        
        .daily-quests .quest:last-child {
            border-bottom: none;
        }
        
        .quest-info {
            flex: 1;
        }
        
        .quest-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .quest-progress {
            height: 5px;
            background-color: var(--card-border);
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-red-light));
            border-radius: 3px;
            transition: width 0.5s;
        }
        
        .quest-reward {
            background-color: rgba(255, 215, 0, 0.2);
            color: var(--premium-color);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            white-space: nowrap;
            margin-left: 10px;
        }
        
        /* Центральная панель - истории */
        .stories-section {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .section-header h2 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background-color: var(--accent-red);
            color: white;
        }
        
        .stories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .story-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid var(--card-border);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .story-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(139, 0, 0, 0.3);
        }
        
        .story-image {
            height: 180px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        .story-badges {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 5px;
        }
        
        .story-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .badge-premium {
            background-color: var(--premium-color);
            color: #000;
        }
        
        .badge-new {
            background-color: var(--success-color);
            color: white;
        }
        
        .badge-interactive {
            background-color: var(--level-1);
            color: white;
        }
        
        .story-content {
            padding: 20px;
        }
        
        .story-content h3 {
            margin-bottom: 10px;
            font-size: 1.3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .story-rating {
            color: var(--premium-color);
            font-size: 0.9rem;
        }
        
        .story-content p {
            color: var(--text-muted);
            font-size: 0.95rem;
            margin-bottom: 15px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .story-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 15px;
        }
        
        .story-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .story-tag {
            background-color: rgba(139, 0, 0, 0.2);
            color: var(--accent-red);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }
        
        .story-actions {
            display: flex;
            gap: 10px;
        }
        
        .story-btn {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .read-btn {
            background-color: var(--accent-red);
            color: white;
        }
        
        .read-btn:hover {
            background-color: var(--accent-red-light);
        }
        
        .bookmark-btn {
            background-color: transparent;
            color: var(--text-color);
            border: 1px solid var(--card-border);
        }
        
        .bookmark-btn:hover {
            background-color: var(--card-border);
        }
        
        /* Правая панель - социальные функции */
        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* Таблица лидеров */
        .leaderboard {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid var(--card-border);
        }
        
        .leaderboard h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--premium-color);
        }
        
        .leaderboard-list {
            list-style: none;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .leaderboard-item.me {
            background-color: rgba(139, 0, 0, 0.2);
            border: 1px solid var(--accent-red);
        }
        
        .rank {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .rank-1 { background-color: gold; color: black; }
        .rank-2 { background-color: silver; color: black; }
        .rank-3 { background-color: #cd7f32; color: black; }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-weight: bold;
        }
        
        .user-level {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        .user-score {
            font-weight: bold;
            color: var(--premium-color);
        }
        
        /* Достижения */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .achievement {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .achievement:hover {
            transform: scale(1.05);
        }
        
        .achievement.locked {
            opacity: 0.5;
        }
        
        .achievement-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-desc {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        /* Сезонное событие */
        .seasonal-event {
            background: linear-gradient(135deg, #8b0000, #000);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid var(--premium-color);
            position: relative;
            overflow: hidden;
        }
        
        .seasonal-event::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--premium-color), #ff6b6b, var(--premium-color));
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: 200px 0; }
        }
        
        .event-title {
            color: var(--premium-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .event-timer {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .timer-unit {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            min-width: 60px;
        }
        
        .timer-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        
        .timer-label {
            font-size: 0.8rem;
            color: var(--text-muted);
        }
        
        /* Реклама */
        .ad-banner {
            background: linear-gradient(90deg, var(--darker-bg) 0%, var(--card-bg) 100%);
            border: 1px solid var(--accent-red);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }
        
        .ad-banner::before {
            content: "РЕКЛАМА";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .ad-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .ad-icon {
            font-size: 2rem;
            color: var(--accent-red);
        }
        
        .ad-text h4 {
            color: var(--accent-red);
            margin-bottom: 5px;
        }
        
        .ad-text p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .ad-button {
            background-color: var(--accent-red);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .ad-button:hover {
            background-color: var(--accent-red-light);
        }
        
        /* Футер */
        footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid var(--card-border);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: var(--accent-red);
            text-decoration: none;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        /* Модальные окна */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            display: none;
        }
        
        .modal-content {
            background-color: var(--card-bg);
            border-radius: 15px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 2px solid var(--accent-red);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Окно скримера */
        .screamer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            display: none;
        }
        
        .screamer-image {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            box-shadow: 0 0 100px rgba(139, 0, 0, 0.9);
        }
        
        /* Анимации */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Уведомления */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--card-bg);
            border-left: 4px solid var(--accent-red);
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 1500;
            display: none;
            max-width: 300px;
        }
        
        /* Прогресс уровня */
        .level-container {
            margin: 20px 0;
        }
        
        .level-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .level-bar {
            height: 10px;
            background-color: var(--card-border);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .level-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--level-1), var(--level-2), var(--level-3));
            border-radius: 5px;
            transition: width 0.5s;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Шапка -->
        <header>
            <div class="logo">
                <i class="fas fa-ghost"></i>
                <div>
                    <h1>Хоррор <span>Истории</span></h1>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">Продвинутая версия</p>
                </div>
            </div>
            
            <div class="user-panel">
                <div class="user-stats">
                    <div class="stat-item level">
                        <i class="fas fa-star"></i>
                        <span id="user-level">15</span>
                    </div>
                    <div class="stat-item coins">
                        <i class="fas fa-coins"></i>
                        <span id="user-coins">1245</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-fire"></i>
                        <span id="streak-count">7</span>
                    </div>
                </div>
                <div class="user-avatar online" id="user-avatar">
                    ТГ
                </div>
            </div>
        </header>
        
        <!-- Навигация -->
        <div class="main-nav">
            <button class="nav-btn active" data-section="stories">
                <i class="fas fa-book"></i> Истории
            </button>
            <button class="nav-btn" data-section="interactive">
                <i class="fas fa-gamepad"></i> Интерактивные
            </button>
            <button class="nav-btn" data-section="challenges">
                <i class="fas fa-trophy"></i> Вызовы
            </button>
            <button class="nav-btn" data-section="social">
                <i class="fas fa-users"></i> Социальное
            </button>
            <button class="nav-btn" data-section="premium">
                <i class="fas fa-crown"></i> Премиум
            </button>
            <button class="nav-btn" id="settings-btn">
                <i class="fas fa-cog"></i> Настройки
            </button>
        </div>
        
        <!-- Рекламный баннер -->
        <div class="ad-banner" id="main-ad">
            <div class="ad-content">
                <i class="fas fa-robot ad-icon"></i>
                <div class="ad-text">
                    <h4>Новый ИИ-сценарист!</h4>
                    <p>Генерирует уникальные хоррор-истории по вашему запросу</p>
                </div>
            </div>
            <button class="ad-button pulse" id="try-ai-btn">Попробовать</button>
        </div>
        
        <!-- Основной контент -->
        <div class="main-content">
            <!-- Левая панель -->
            <aside class="left-sidebar">
                <div class="sidebar-card">
                    <h3><i class="fas fa-user"></i> Мой прогресс</h3>
                    <div class="level-container">
                        <div class="level-info">
                            <span>Уровень <strong id="current-level">15</strong></span>
                            <span id="current-xp">1250/2000 XP</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="level-fill" style="width: 62.5%"></div>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <p><i class="fas fa-history"></i> Время в приложении: <strong>24ч 15м</strong></p>
                        <p><i class="fas fa-book-reader"></i> Прочитано историй: <strong>47</strong></p>
                    </div>
                </div>
                
                <div class="sidebar-card daily-quests">
                    <h3><i class="fas fa-tasks"></i> Ежедневные задания</h3>
                    <div class="quest-list">
                        <div class="quest">
                            <div class="quest-info">
                                <div class="quest-title">Прочитать 3 истории</div>
                                <div class="quest-progress">
                                    <div class="progress-bar" style="width: 66%"></div>
                                </div>
                            </div>
                            <div class="quest-reward">+30 <i class="fas fa-coins"></i></div>
                        </div>
                        <div class="quest">
                            <div class="quest-info">
                                <div class="quest-title">Поделиться с другом</div>
                                <div class="quest-progress">
                                    <div class="progress-bar" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="quest-reward">+50 <i class="fas fa-coins"></i></div>
                        </div>
                        <div class="quest">
                            <div class="quest-info">
                                <div class="quest-title">Получить 5 скримеров</div>
                                <div class="quest-progress">
                                    <div class="progress-bar" style="width: 40%"></div>
                                </div>
                            </div>
                            <div class="quest-reward">+75 <i class="fas fa-coins"></i></div>
                        </div>
                    </div>
                    <button class="story-btn" style="margin-top: 15px;" id="claim-rewards">
                        <i class="fas fa-gift"></i> Забрать награды
                    </button>
                </div>
                
                <div class="sidebar-card">
                    <h3><i class="fas fa-bolt"></i> Активность друзей</h3>
                    <div id="friends-activity">
                        <p><i class="fas fa-user-friends"></i> <strong>Алексей</strong> прочитал "Темный лес"</p>
                        <p><i class="fas fa-user-friends"></i> <strong>Мария</strong> получила достижение</p>
                        <p><i class="fas fa-user-friends"></i> <strong>Иван</strong> купил премиум</p>
                    </div>
                    <button class="story-btn" style="margin-top: 15px;" id="add-friends">
                        <i class="fas fa-user-plus"></i> Добавить друзей
                    </button>
                </div>
            </aside>
            
            <!-- Центральная панель -->
            <main class="stories-section">
                <div class="section-header">
                    <h2><i class="fas fa-book-open"></i> Рекомендуемые истории</h2>
                    <div class="filters">
                        <button class="filter-btn active">Все</button>
                        <button class="filter-btn">Популярные</button>
                        <button class="filter-btn">Новые</button>
                        <button class="filter-btn">Скримеры</button>
                        <button class="filter-btn">Короткие</button>
                    </div>
                </div>
                
                <div class="stories-grid" id="stories-grid">
                    <!-- Истории будут загружены через JavaScript -->
                </div>
                
                <!-- Сезонное событие -->
                <div class="seasonal-event">
                    <h3 class="event-title"><i class="fas fa-pumpkin"></i> Хэллоуинское безумие</h3>
                    <p>Специальные истории, уникальные скримеры и эксклюзивные награды!</p>
                    <div class="event-timer">
                        <div class="timer-unit">
                            <div class="timer-value" id="event-days">12</div>
                            <div class="timer-label">дней</div>
                        </div>
                        <div class="timer-unit">
                            <div class="timer-value" id="event-hours">04</div>
                            <div class="timer-label">часов</div>
                        </div>
                        <div class="timer-unit">
                            <div class="timer-value" id="event-minutes">32</div>
                            <div class="timer-label">минут</div>
                        </div>
                    </div>
                    <button class="story-btn" style="background: var(--premium-color); color: black; width: 100%;">
                        <i class="fas fa-ghost"></i> Участвовать в событии
                    </button>
                </div>
            </main>
            
            <!-- Правая панель -->
            <aside class="right-sidebar">
                <div class="leaderboard">
                    <h3><i class="fas fa-trophy"></i> Таблица лидеров</h3>
                    <ul class="leaderboard-list" id="leaderboard-list">
                        <!-- Лидеры будут загружены через JavaScript -->
                    </ul>
                </div>
                
                <div class="sidebar-card">
                    <h3><i class="fas fa-award"></i> Достижения</h3>
                    <div class="achievements-grid" id="achievements-grid">
                        <!-- Достижения будут загружены через JavaScript -->
                    </div>
                </div>
                
                <div class="ad-banner">
                    <div class="ad-content">
                        <div class="ad-text">
                            <h4>Telegram Premium</h4>
                            <p>Получите эксклюзивный контент в нашем боте</p>
                        </div>
                    </div>
                    <button class="ad-button" id="tg-premium-btn">
                        <i class="fab fa-telegram"></i> Подписаться
                    </button>
                </div>
                
                <div class="sidebar-card">
                    <h3><i class="fas fa-gamepad"></i> Совместный режим</h3>
                    <p style="margin-bottom: 15px;">Играйте вместе с друзьями в режиме реального времени</p>
                    <button class="story-btn" id="create-room-btn" style="margin-bottom: 10px;">
                        <i class="fas fa-plus"></i> Создать комнату
                    </button>
                    <button class="story-btn bookmark-btn" id="join-room-btn">
                        <i class="fas fa-door-open"></i> Присоединиться
                    </button>
                </div>
            </aside>
        </div>
        
        <!-- Футер -->
        <footer>
            <p>Хоррор Истории | Расширенная версия © 2023</p>
            <div class="footer-links">
                <a href="#">Политика конфиденциальности</a>
                <a href="#">Условия использования</a>
                <a href="#">Поддержка</a>
                <a href="#">API для разработчиков</a>
                <a href="#">Telegram канал</a>
                <a href="#">Вакансии</a>
            </div>
            <p>Приложение интегрировано с Telegram Web App. Для полного функционала используйте Telegram.</p>
        </footer>
    </div>
    
    <!-- Модальные окна -->
    <div class="modal" id="story-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Заголовок истории</h2>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Контент истории -->
            </div>
        </div>
    </div>
    
    <div class="modal" id="premium-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-crown"></i> Премиум подписка</h2>
                <button class="modal-close" id="premium-close">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 30px;">
                    <h3 style="color: var(--premium-color); margin-bottom: 20px;">Выберите тариф</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="sidebar-card" style="text-align: left;">
                            <h4>Базовый</h4>
                            <p><strong>Бесплатно</strong></p>
                            <ul style="margin: 15px 0; padding-left: 20px;">
                                <li>1 история в день</li>
                                <li>Базовая реклама</li>
                                <li>Ограниченные скримеры</li>
                            </ul>
                            <button class="story-btn bookmark-btn" disabled>Текущий план</button>
                        </div>
                        
                        <div class="sidebar-card" style="border: 2px solid var(--premium-color); text-align: left;">
                            <h4><i class="fas fa-crown"></i> Премиум</h4>
                            <p><strong>299₽ / месяц</strong></p>
                            <ul style="margin: 15px 0; padding-left: 20px;">
                                <li>Все истории без ограничений</li>
                                <li>Без рекламы</li>
                                <li>Эксклюзивные скримеры</li>
                                <li>+50 монет ежедневно</li>
                            </ul>
                            <button class="story-btn read-btn" id="buy-premium">Купить</button>
                        </div>
                        
                        <div class="sidebar-card" style="text-align: left;">
                            <h4><i class="fas fa-gem"></i> VIP</h4>
                            <p><strong>799₽ / месяц</strong></p>
                            <ul style="margin: 15px 0; padding-left: 20px;">
                                <li>Все премиум функции</li>
                                <li>Ранний доступ к новым историям</li>
                                <li>Создание своих историй</li>
                                <li>+150 монет ежедневно</li>
                            </ul>
                            <button class="story-btn read-btn" id="buy-vip">Купить VIP</button>
                        </div>
                    </div>
                    
                    <div class="ad-banner" style="margin: 20px 0;">
                        <div class="ad-content">
                            <i class="fas fa-coins ad-icon"></i>
                            <div class="ad-text">
                                <h4>Нужны монеты?</h4>
                                <p>Купите пакет монет для разблокировки историй</p>
                            </div>
                        </div>
                        <button class="ad-button" id="buy-coins-btn">Купить монеты</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-cog"></i> Настройки</h2>
                <button class="modal-close" id="settings-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="sidebar-card" style="margin-bottom: 20px;">
                    <h3><i class="fas fa-sliders-h"></i> Уровень страха</h3>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                            <button class="filter-btn active">Лёгкий</button>
                            <button class="filter-btn">Средний</button>
                            <button class="filter-btn">Экстремальный</button>
                        </div>
                        <p style="color: var(--text-muted); font-size: 0.9rem;">Настройте интенсивность скримеров и уровень ужаса в историях</p>
                    </div>
                </div>
                
                <div class="sidebar-card" style="margin-bottom: 20px;">
                    <h3><i class="fas fa-volume-up"></i> Звук</h3>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>Фоновая музыка</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>Звуковые эффекты</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="margin-top: 15px;">
                            <label>Громкость</label>
                            <input type="range" min="0" max="100" value="70" style="width: 100%; margin-top: 10px;">
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-card">
                    <h3><i class="fas fa-bell"></i> Уведомления</h3>
                    <div style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>Новые истории</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span>Активность друзей</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Ежедневные награды</span>
                            <label class="switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Окно скримера -->
    <div class="screamer-overlay" id="screamer-overlay">
        <img src="" alt="Скример" class="screamer-image" id="screamer-image">
    </div>
    
    <!-- Уведомление -->
    <div class="notification" id="notification">
        <div id="notification-content"></div>
    </div>

    <!-- Скрипты -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script>
        // Данные приложения
        const appData = {
            // Состояние пользователя
            user: {
                id: 1,
                name: "Telegram User",
                level: 15,
                xp: 1250,
                maxXp: 2000,
                coins: 1245,
                streak: 7,
                isPremium: false,
                isVIP: false,
                achievements: [1, 2, 4, 7],
                settings: {
                    horrorLevel: "medium",
                    sound: {
                        music: true,
                        effects: true,
                        volume: 70
                    },
                    notifications: {
                        newStories: true,
                        friendActivity: true,
                        dailyRewards: true
                    }
                }
            },
            
            // Данные историй
            stories: [
                {
                    id: 1,
                    title: "Темный лес",
                    description: "Группа друзей решает исследовать заброшенный дом в лесу, но не все возвращаются...",
                    image: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["Лес", "Призраки", "Выживание"],
                    content: "Было уже поздно, когда мы решили отправиться в тот лес. Марк утверждал, что видел там странные огни, и мы, будучи любопытными студентами, не могли устоять перед соблазном исследовать это место. Дорога заняла больше времени, чем мы ожидали, и к тому времени, как мы дошли до заброшенного дома, уже стемнело. Воздух был холодным и влажным, а тишину нарушал только скрип старых деревьев...",
                    rating: 4.7,
                    reads: 1245,
                    time: "15 мин",
                    premium: false,
                    interactive: false,
                    new: false,
                    screamerChance: 30
                },
                {
                    id: 2,
                    title: "Зеркало в подвале",
                    description: "Старинное зеркало, найденное на чердаке, показывает больше, чем просто отражение...",
                    image: "https://images.unsplash.com/photo-1533090481720-856c6e3c1fdc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["Зеркала", "Проклятие", "Дом"],
                    content: "Когда я переехал в старый дом бабушки, первое, что я нашел на чердаке, было огромное зеркало в резной деревянной раме. Оно было покрыто толстым слоем пыли, но даже сквозь него я мог разглядеть свое отражение. Сначала я не заметил ничего странного, но через несколько дней я начал видеть в зеркале не только себя. Иногда в отражении появлялась тень, которая стояла позади меня, но когда я оборачивался, там никого не было...",
                    rating: 4.9,
                    reads: 892,
                    time: "12 мин",
                    premium: false,
                    interactive: true,
                    new: true,
                    screamerChance: 50
                },
                {
                    id: 3,
                    title: "Больница Святой Марии",
                    description: "Ночная смена в заброшенной больнице становится кошмаром для молодой медсестры.",
                    image: "https://images.unsplash.com/photo-1582750433449-648ed127bb54?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["Больница", "Призраки", "Психологический"],
                    content: "Моя первая ночная смена в больнице Святой Марии началась спокойно. Старое здание, построенное еще в XIX веке, имело мрачную репутацию, но я не верила в сказки о призраках. До тех пор, пока не услышала детский плач, доносящийся из заброшенного крыла. Дежурный врач сказал, что мне показалось, но когда я пошла проверить, я увидела силуэт маленькой девочки в конце коридора. Она махнула мне рукой, а затем исчезла в темноте...",
                    rating: 4.8,
                    reads: 1567,
                    time: "20 мин",
                    premium: true,
                    interactive: false,
                    new: false,
                    screamerChance: 70
                },
                {
                    id: 4,
                    title: "Радиосигнал из прошлого",
                    description: "Любитель радио настраивается на частоту, которая транслирует передачи из 1940-х годов.",
                    image: "https://images.unsplash.com/photo-1589256469067-ea99122bbdc4?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["Радио", "Время", "Тайна"],
                    content: "Все началось с того, что я купил старый радиоприемник на барахолке. Продавец предупредил меня, что приемник имеет 'необычные свойства', но я лишь посмеялся над этим. Однако той же ночью, настраивая частоты, я поймал странный сигнал. Голос диктора сообщал новости о наступлении немецких войск под Сталинградом. Сначала я подумал, что это какая-то радиопостановка, но даты и детали были слишком точными. А затем голос внезапно прервался и прошептал мое имя...",
                    rating: 4.5,
                    reads: 743,
                    time: "18 мин",
                    premium: false,
                    interactive: true,
                    new: true,
                    screamerChance: 40
                },
                {
                    id: 5,
                    title: "Кукла в наследство",
                    description: "Антикварная кукла, полученная в наследство, ведет себя слишком реалистично.",
                    image: "https://images.unsplash.com/photo-1531131141861-4f58d4fcb6c9?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["Куклы", "Проклятие", "Наследство"],
                    content: "Моя тетя оставила мне в наследство коллекцию антикварных кукол. Среди них была одна особенная - фарфоровая кукла в викторианском платье с пронзительными голубыми глазами. Тетя всегда говорила, что эта кукла особенная и требует уважительного обращения. В первую же ночь после переезда кукол в мой дом, я проснулась от звука тихого смеха. Фарфоровая кукла сидела на стуле у моей кровати, хотя я точно помнила, что оставила ее в гостиной. На следующее утро я обнаружила, что она снова вернулась на свое место, но ее поза изменилась...",
                    rating: 4.9,
                    reads: 2103,
                    time: "25 мин",
                    premium: true,
                    interactive: false,
                    new: false,
                    screamerChance: 60
                }
            ],
            
            // Интерактивные истории
            interactiveStories: [
                {
                    id: 101,
                    title: "Лабиринт зеркал",
                    description: "Вы заблудились в бесконечном лабиринте, где каждое зеркало показывает вашу возможную судьбу.",
                    image: "https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["Интерактивная", "Лабиринт", "Зеркала", "Выбор"],
                    segments: 12,
                    endings: 5,
                    rating: 4.9,
                    reads: 892,
                    time: "30-45 мин",
                    premium: true
                }
            ],
            
            // Достижения
            achievements: [
                { id: 1, name: "Новичок ужасов", desc: "Прочитать 5 историй", icon: "👻", reward: 50 },
                { id: 2, name: "Неустрашимый", desc: "Увидеть 10 скримеров", icon: "💀", reward: 100 },
                { id: 3, name: "Ночной исследователь", desc: "Читать после полуночи", icon: "🕯️", reward: 75 },
                { id: 4, name: "Коллекционер", desc: "Прочитать все истории", icon: "📚", reward: 200 },
                { id: 5, name: "Мастер страха", desc: "Пройти 10 интерактивных историй", icon: "🎮", reward: 300 },
                { id: 6, name: "Социальная бабочка", desc: "Добавить 10 друзей", icon: "🦋", reward: 150 },
                { id: 7, name: "Неделя храбрости", desc: "7-дневная серия входов", icon: "🔥", reward: 250 },
                { id: 8, name: "Легенда хоррора", desc: "Достичь 20 уровня", icon: "🏆", reward: 500 }
            ],
            
            // Таблица лидеров
            leaderboard: [
                { id: 1, name: "Алексей", level: 25, score: 2450, isMe: false },
                { id: 2, name: "Мария", level: 22, score: 1980, isMe: false },
                { id: 3, name: "Иван", level: 21, score: 1750, isMe: false },
                { id: 4, name: "Telegram User", level: 15, score: 1245, isMe: true },
                { id: 5, name: "Анна", level: 14, score: 1100, isMe: false },
                { id: 6, name: "Дмитрий", level: 13, score: 980, isMe: false },
                { id: 7, name: "Екатерина", level: 12, score: 850, isMe: false }
            ],
            
            // Скримеры
            screamers: [
                "https://images.unsplash.com/photo-1531063600318-9583b6d02d6a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                "https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                "https://images.unsplash.com/photo-1534423861386-85a16f5d13fd?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                "https://images.unsplash.com/photo-1513836279014-a89f7a76ae86?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
            ],
            
            // Система скримеров
            screamerAI: {
                userEngagement: 0,
                lastScreamerTime: 0,
                userSensitivity: 50,
                intensity: {
                    low: 0.2,
                    medium: 0.5,
                    high: 0.8
                }
            },
            
            // Таймер события
            eventEndDate: new Date(Date.now() + 12 * 24 * 60 * 60 * 1000) // 12 дней от текущей даты
        };
        
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupEventListeners();
            startEventTimer();
            updateUI();
            
            // Имитация Telegram Web App
            if (window.Telegram && Telegram.WebApp) {
                initTelegramIntegration();
            } else {
                // Заглушка для тестирования
                console.log('Telegram Web App не обнаружен, запуск в тестовом режиме');
            }
        });
        
        // Инициализация приложения
        function initApp() {
            // Установка начальных значений
            updateUserStats();
            renderStories();
            renderLeaderboard();
            renderAchievements();
            
            // Запуск фоновых процессов
            startEngagementTracking();
            setInterval(checkForScreamer, 30000); // Проверка каждые 30 секунд
            setInterval(updateFriendsActivity, 60000); // Обновление активности друзей
        }
        
        // Обновление статистики пользователя
        function updateUserStats() {
            document.getElementById('user-level').textContent = appData.user.level;
            document.getElementById('user-coins').textContent = appData.user.coins;
            document.getElementById('streak-count').textContent = appData.user.streak;
            document.getElementById('current-level').textContent = appData.user.level;
            document.getElementById('current-xp').textContent = `${appData.user.xp}/${appData.user.maxXp} XP`;
            
            const xpPercentage = (appData.user.xp / appData.user.maxXp) * 100;
            document.getElementById('level-fill').style.width = `${xpPercentage}%`;
        }
        
        // Рендер историй
        function renderStories() {
            const storiesGrid = document.getElementById('stories-grid');
            storiesGrid.innerHTML = '';
            
            appData.stories.forEach(story => {
                const storyCard = document.createElement('div');
                storyCard.className = 'story-card';
                storyCard.dataset.id = story.id;
                
                // Формируем бейджи
                let badgesHTML = '';
                if (story.premium) badgesHTML += '<div class="story-badge badge-premium">ПРЕМИУМ</div>';
                if (story.interactive) badgesHTML += '<div class="story-badge badge-interactive">ИНТЕРАКТИВ</div>';
                if (story.new) badgesHTML += '<div class="story-badge badge-new">НОВОЕ</div>';
                
                storyCard.innerHTML = `
                    <div class="story-image" style="background-image: url('${story.image}')">
                        <div class="story-badges">
                            ${badgesHTML}
                        </div>
                    </div>
                    <div class="story-content">
                        <h3>
                            ${story.title}
                            <span class="story-rating">
                                <i class="fas fa-star"></i> ${story.rating}
                            </span>
                        </h3>
                        <p>${story.description}</p>
                        
                        <div class="story-stats">
                            <span><i class="fas fa-eye"></i> ${story.reads}</span>
                            <span><i class="fas fa-clock"></i> ${story.time}</span>
                        </div>
                        
                        <div class="story-tags">
                            ${story.tags.map(tag => `<span class="story-tag">${tag}</span>`).join('')}
                        </div>
                        
                        <div class="story-actions">
                            <button class="story-btn read-btn" data-id="${story.id}">
                                <i class="fas fa-book-open"></i> Читать
                            </button>
                            <button class="story-btn bookmark-btn" data-id="${story.id}">
                                <i class="fas fa-bookmark"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                storiesGrid.appendChild(storyCard);
            });
        }
        
        // Рендер таблицы лидеров
        function renderLeaderboard() {
            const leaderboardList = document.getElementById('leaderboard-list');
            leaderboardList.innerHTML = '';
            
            appData.leaderboard.forEach((user, index) => {
                const li = document.createElement('li');
                li.className = `leaderboard-item ${user.isMe ? 'me' : ''}`;
                
                li.innerHTML = `
                    <div class="rank ${index < 3 ? `rank-${index + 1}` : ''}">
                        ${index + 1}
                    </div>
                    <div class="user-info">
                        <div class="user-name">${user.name}</div>
                        <div class="user-level">Уровень ${user.level}</div>
                    </div>
                    <div class="user-score">${user.score}</div>
                `;
                
                leaderboardList.appendChild(li);
            });
        }
        
        // Рендер достижений
        function renderAchievements() {
            const achievementsGrid = document.getElementById('achievements-grid');
            achievementsGrid.innerHTML = '';
            
            appData.achievements.forEach(achievement => {
                const isUnlocked = appData.user.achievements.includes(achievement.id);
                const div = document.createElement('div');
                div.className = `achievement ${isUnlocked ? '' : 'locked'}`;
                div.title = `${achievement.desc} | Награда: ${achievement.reward} монет`;
                
                div.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-name">${achievement.name}</div>
                    <div class="achievement-desc">${isUnlocked ? 'Разблокировано' : 'Заблокировано'}</div>
                `;
                
                div.addEventListener('click', () => {
                    showNotification(isUnlocked ? 
                        `Достижение "${achievement.name}" уже получено!` : 
                        `Достижение "${achievement.name}" заблокировано: ${achievement.desc}`);
                });
                
                achievementsGrid.appendChild(div);
            });
        }
        
        // Показать уведомление
        function showNotification(message, type = 'info') {
            // Используем toastr для красивых уведомлений
            toastr.options = {
                positionClass: 'toast-top-right',
                progressBar: true,
                timeOut: 3000,
                closeButton: true
            };
            
            switch(type) {
                case 'success':
                    toastr.success(message);
                    break;
                case 'warning':
                    toastr.warning(message);
                    break;
                case 'error':
                    toastr.error(message);
                    break;
                default:
                    toastr.info(message);
            }
        }
        
        // Запуск скримера
        function triggerScreamer(type = 'random') {
            const randomScreamer = appData.screamers[Math.floor(Math.random() * appData.screamers.length)];
            document.getElementById('screamer-image').src = randomScreamer;
            document.getElementById('screamer-overlay').style.display = 'flex';
            
            // Обновляем статистику скримеров
            appData.screamerAI.lastScreamerTime = Date.now();
            
            // Воспроизведение звука (закомментировано для удобства тестирования)
            // const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-horror-scream-2896.mp3');
            // audio.volume = appData.user.settings.sound.volume / 100;
            // if (appData.user.settings.sound.effects) audio.play();
            
            // Скрываем скример через случайное время (1.5-3 секунды)
            const duration = 1500 + Math.random() * 1500;
            setTimeout(() => {
                document.getElementById('screamer-overlay').style.display = 'none';
                
                // Показываем сообщение
                const messages = ['БУ! Испугались?', 'Неожиданно, да?', 'А вы храбрый!', 'Сюрприз!'];
                showNotification(messages[Math.floor(Math.random() * messages.length)], 'warning');
                
                // Награда за скример
                appData.user.coins += 10;
                updateUserStats();
            }, duration);
        }
        
        // Проверка на возможность запуска скримера
        function checkForScreamer() {
            const timeSinceLast = Date.now() - appData.screamerAI.lastScreamerTime;
            const timeThreshold = 300000; // 5 минут
            
            // Увеличиваем вовлеченность
            appData.screamerAI.userEngagement = Math.min(100, appData.screamerAI.userEngagement + 5);
            
            // Проверяем условия
            if (appData.screamerAI.userEngagement > 70 && timeSinceLast > timeThreshold) {
                const intensity = appData.screamerAI.intensity[appData.user.settings.horrorLevel] || 0.5;
                
                if (Math.random() < intensity) {
                    triggerScreamer();
                }
            }
        }
        
        // Отслеживание вовлеченности
        function startEngagementTracking() {
            let lastActivity = Date.now();
            
            // Отслеживаем активность пользователя
            document.addEventListener('click', () => {
                lastActivity = Date.now();
                appData.screamerAI.userEngagement = Math.min(100, appData.screamerAI.userEngagement + 10);
            });
            
            document.addEventListener('scroll', () => {
                lastActivity = Date.now();
                appData.screamerAI.userEngagement = Math.min(100, appData.screamerAI.userEngagement + 5);
            });
            
            // Уменьшаем вовлеченность со временем
            setInterval(() => {
                const inactiveTime = Date.now() - lastActivity;
                if (inactiveTime > 60000) { // 1 минута неактивности
                    appData.screamerAI.userEngagement = Math.max(0, appData.screamerAI.userEngagement - 2);
                }
            }, 10000);
        }
        
        // Таймер события
        function startEventTimer() {
            function updateTimer() {
                const now = new Date();
                const diff = appData.eventEndDate - now;
                
                if (diff > 0) {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    
                    document.getElementById('event-days').textContent = days.toString().padStart(2, '0');
                    document.getElementById('event-hours').textContent = hours.toString().padStart(2, '0');
                    document.getElementById('event-minutes').textContent = minutes.toString().padStart(2, '0');
                } else {
                    // Событие завершено
                    document.getElementById('event-days').textContent = '00';
                    document.getElementById('event-hours').textContent = '00';
                    document.getElementById('event-minutes').textContent = '00';
                }
            }
            
            updateTimer();
            setInterval(updateTimer, 60000); // Обновляем каждую минуту
        }
        
        // Обновление активности друзей
        function updateFriendsActivity() {
            const activities = [
                'прочитал новую историю',
                'получил достижение',
                'прошел интерактивную историю',
                'получил скример',
                'поднялся в таблице лидеров',
                'купил премиум подписку'
            ];
            
            const friends = ['Алексей', 'Мария', 'Иван', 'Анна', 'Дмитрий', 'Екатерина'];
            const activityList = document.getElementById('friends-activity');
            
            // Генерируем новую активность
            const newActivities = [];
            for (let i = 0; i < 3; i++) {
                const friend = friends[Math.floor(Math.random() * friends.length)];
                const activity = activities[Math.floor(Math.random() * activities.length)];
                newActivities.push(`<p><i class="fas fa-user-friends"></i> <strong>${friend}</strong> ${activity}</p>`);
            }
            
            activityList.innerHTML = newActivities.join('');
        }
        
        // Настройка обработчиков событий
        function setupEventListeners() {
            // Навигация
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.dataset.section;
                    
                    // Убираем активный класс у всех кнопок
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    // Добавляем активный класс текущей кнопке
                    this.classList.add('active');
                    
                    // Здесь можно реализовать переключение секций
                    showNotification(`Раздел "${this.textContent.trim()}" в разработке`, 'info');
                });
            });
            
            // Кнопка настроек
            document.getElementById('settings-btn').addEventListener('click', () => {
                document.getElementById('settings-modal').style.display = 'flex';
            });
            
            // Закрытие модальных окон
            document.getElementById('modal-close').addEventListener('click', () => {
                document.getElementById('story-modal').style.display = 'none';
            });
            
            document.getElementById('premium-close').addEventListener('click', () => {
                document.getElementById('premium-modal').style.display = 'none';
            });
            
            document.getElementById('settings-close').addEventListener('click', () => {
                document.getElementById('settings-modal').style.display = 'none';
            });
            
            // Закрытие по клику вне окна
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
            
            // Закрытие скримера
            document.getElementById('screamer-overlay').addEventListener('click', function() {
                this.style.display = 'none';
            });
            
            // Кнопки историй
            document.addEventListener('click', function(e) {
                // Кнопка "Читать"
                if (e.target.closest('.read-btn')) {
                    const storyId = parseInt(e.target.closest('.read-btn').dataset.id);
                    openStory(storyId);
                }
                
                // Кнопка закладки
                if (e.target.closest('.bookmark-btn')) {
                    const storyId = parseInt(e.target.closest('.bookmark-btn').dataset.id);
                    toggleBookmark(storyId);
                }
            });
            
            // Премиум модалка
            document.querySelectorAll('[data-section="premium"], #buy-premium, #buy-vip').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('premium-modal').style.display = 'flex';
                });
            });
            
            // Покупка монет
            document.getElementById('buy-coins-btn').addEventListener('click', () => {
                const coinPacks = [
                    { name: "100 монет", price: 99, coins: 100 },
                    { name: "500 монет", price: 399, coins: 500 },
                    { name: "1200 монет", price: 799, coins: 1200 }
                ];
                
                showNotification("Функция покупки монет в разработке", 'info');
            });
            
            // Забрать награды
            document.getElementById('claim-rewards').addEventListener('click', () => {
                appData.user.coins += 155; // Сумма наград из заданий
                updateUserStats();
                showNotification('Награды получены! +155 монет', 'success');
            });
            
            // Добавить друзей
            document.getElementById('add-friends').addEventListener('click', () => {
                showNotification('Интеграция с Telegram для добавления друзей в разработке', 'info');
            });
            
            // Совместный режим
            document.getElementById('create-room-btn').addEventListener('click', () => {
                showNotification('Создание комнаты для совместной игры в разработке', 'info');
            });
            
            document.getElementById('join-room-btn').addEventListener('click', () => {
                showNotification('Присоединение к комнате в разработке', 'info');
            });
            
            // Рекламные кнопки
            document.getElementById('try-ai-btn').addEventListener('click', () => {
                // 20% шанс на скример при клике на рекламу
                if (Math.random() < 0.2) {
                    setTimeout(triggerScreamer, 500);
                }
                
                setTimeout(() => {
                    showNotification('ИИ-сценарист в разработке. +10 монет за интерес', 'info');
                    appData.user.coins += 10;
                    updateUserStats();
                }, 1000);
            });
            
            document.getElementById('tg-premium-btn').addEventListener('click', () => {
                showNotification('Переход в Telegram для премиум подписки в разработке', 'info');
            });
            
            // Фильтры
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filter = this.textContent;
                    showNotification(`Фильтр "${filter}" применен`, 'info');
                });
            });
        }
        
        // Открытие истории
        function openStory(storyId) {
            const story = appData.stories.find(s => s.id === storyId);
            if (!story) return;
            
            // Проверка премиум-доступа
            if (story.premium && !appData.user.isPremium && !appData.user.isVIP) {
                document.getElementById('premium-modal').style.display = 'flex';
                showNotification('Эта история доступна только для премиум пользователей!', 'warning');
                return;
            }
            
            // Показываем модальное окно с историей
            document.getElementById('modal-title').textContent = story.title;
            document.getElementById('modal-body').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div class="story-tags" style="margin-bottom: 20px;">
                        ${story.tags.map(tag => `<span class="story-tag">${tag}</span>`).join('')}
                    </div>
                    
                    <div style="background-color: rgba(0, 0, 0, 0.3); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="font-size: 1.1rem; line-height: 1.7;">${story.content}</p>
                    </div>
                    
                    <p style="font-style: italic; color: var(--accent-red); text-align: center; margin: 30px 0;">
                        Продолжение следует... Загляните завтра!
                    </p>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 30px; flex-wrap: wrap; gap: 10px;">
                    <button id="rate-story" style="background-color: var(--accent-red); color: white; border: none; padding: 10px 20px; border-radius: 5px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-star"></i> Оценить историю
                    </button>
                    <button id="share-story" style="background-color: var(--card-border); color: white; border: none; padding: 10px 20px; border-radius: 5px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-share-alt"></i> Поделиться
                    </button>
                    <button id="generate-ending" style="background: linear-gradient(135deg, var(--level-1), var(--level-3)); color: white; border: none; padding: 10px 20px; border-radius: 5px; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-robot"></i> ИИ-продолжение
                    </button>
                </div>
                
                <div style="margin-top: 20px; text-align: center; color: var(--text-muted); font-size: 0.9rem;">
                    <p><i class="fas fa-exclamation-triangle"></i> Внимание! Возможен внезапный скример при чтении</p>
                </div>
            `;
            
            document.getElementById('story-modal').style.display = 'flex';
            
            // Добавляем обработчики для кнопок в модальном окне
            setTimeout(() => {
                document.getElementById('rate-story').addEventListener('click', function() {
                    showNotification('Спасибо за оценку! +10 монет', 'success');
                    appData.user.coins += 10;
                    appData.user.xp += 25;
                    updateUserStats();
                });
                
                document.getElementById('share-story').addEventListener('click', function() {
                    showNotification('Ссылка на историю скопирована в буфер обмена!', 'success');
                });
                
                document.getElementById('generate-ending').addEventListener('click', function() {
                    showNotification('ИИ генерирует альтернативное продолжение...', 'info');
                    setTimeout(() => {
                        showNotification('ИИ-продолжение готово! +15 монет за использование', 'success');
                        appData.user.coins += 15;
                        updateUserStats();
                    }, 2000);
                });
                
                // Шанс запуска скримера после прочтения
                if (Math.random() * 100 < story.screamerChance) {
                    setTimeout(() => {
                        if (Math.random() < 0.7) { // 70% шанс скримера
                            triggerScreamer();
                        }
                    }, 3000);
                }
                
                // Увеличиваем XP за прочтение
                appData.user.xp += 50;
                if (appData.user.xp >= appData.user.maxXp) {
                    levelUp();
                }
                updateUserStats();
            }, 100);
        }
        
        // Переключение закладки
        function toggleBookmark(storyId) {
            showNotification('История добавлена в закладки', 'success');
        }
        
        // Повышение уровня
        function levelUp() {
            appData.user.level++;
            appData.user.xp = appData.user.xp - appData.user.maxXp;
            appData.user.maxXp = Math.floor(appData.user.maxXp * 1.5);
            appData.user.coins += 100;
            
            showNotification(`Поздравляем! Вы достигли ${appData.user.level} уровня! +100 монет`, 'success');
            
            // Проверяем достижения
            if (appData.user.level >= 20 && !appData.user.achievements.includes(8)) {
                appData.user.achievements.push(8);
                showNotification('Новое достижение: Легенда хоррора! +500 монет', 'success');
                appData.user.coins += 500;
                renderAchievements();
            }
        }
        
        // Обновление UI
        function updateUI() {
            // Обновляем статус премиума
            if (appData.user.isPremium || appData.user.isVIP) {
                document.querySelector('.user-avatar').style.background = 
                    'linear-gradient(135deg, var(--premium-color), #ffaa00)';
            }
        }
        
        // Имитация интеграции с Telegram
        function initTelegramIntegration() {
            const tg = Telegram.WebApp;
            
            // Расширяем на весь экран
            tg.expand();
            
            // Настраиваем тему
            tg.setHeaderColor('#0a0a0a');
            tg.setBackgroundColor('#0a0a0a');
            
            // Получаем данные пользователя
            const user = tg.initDataUnsafe.user;
            if (user) {
                appData.user.name = user.first_name || 'Пользователь';
                document.querySelector('.user-avatar').textContent = user.first_name ? user.first_name[0] : 'ТГ';
                
                if (user.photo_url) {
                    document.querySelector('.user-avatar').style.backgroundImage = `url(${user.photo_url})`;
                    document.querySelector('.user-avatar').style.backgroundSize = 'cover';
                }
            }
            
            // Кнопка для оплаты
            tg.MainButton.text = "КУПИТЬ ПРЕМИУМ";
            tg.MainButton.color = "#ffd700";
            tg.MainButton.textColor = "#000000";
            tg.MainButton.onClick(() => {
                document.getElementById('premium-modal').style.display = 'flex';
            });
            tg.MainButton.show();
            
            showNotification('Telegram Web App успешно подключен', 'success');
        }
    </script>
</body>
</html>
